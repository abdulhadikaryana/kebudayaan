<?php
$create_url = $this->url(array('action' => 'create'));
foreach ($this->messages as $inde => $message):
    ?>  <div class="alert alert-success">    <a href="#" data-dismiss="alert" class="close">x</a>    <strong><?php echo $message; ?></strong>  </div><?php endforeach; ?><form action="" method="post">  <?php
echo $this->formHidden('action', 'sort');
echo $this->formHidden('filter[sort]', $this->filter['sort']);
echo $this->formHidden('filter[order]', $this->filter['order']);
?>  <div class="row-fluid">    <h3 class="page-title"><span>Kegiatan</span></h3>    <div class="pull-left">      <a href="<?php echo $create_url; ?>"         class="btn btn-red">        Tambah Kegiatan</a>    </div>    <p class="pull-right">      Tampilkan      <?php echo $this->formSelect('filter[row]', $this->filter['row'], array('style' => 'width:50px'), array(5 => 5, 10 => 10, 15 => 15, 25 => 25, 50 => 50, 100 => 100)); ?>      <button class="btn btn-cyan" name="action" value="filter">Setel</button>    </p>  </div>  <hr>  <div class="row-fluid">    <div class="row-fluid">      <div class="pull-left">        <button name="action"                value="filter"                style="visibility: hidden;position: absolute"></button>        <button name="action"                value="delete"                class="btn btn-icon-only btn-cyan"                onclick="                  if (!confirm('Apakah anda yakin ingin menghapus ' + 'kegiatan-kegiatan ini?'))
            return false">          <span class="rulycon-remove-2"></span>        </button>        <?php if ('' != $this->filter['status'] && $this->filter['status'] == 0): ?>          <button class="btn btn-cyan"                  name="action"                  value="restore"                  title="Muat Ulang">            <span class="rulycon-spinner-6"></span>          </button>        <?php endif; ?>        <button class="btn btn-cyan"                name="action"                value="filter">          Gunakan Filter        </button>        <button name="action"                value="reset"                class="btn btn-cyan">          Atur Ulang Filter        </button>      </div>      <div class="pull-right">        <?php echo $this->paginationControl($this->events, 'sliding', 'partial/pagination_control.phtml'); ?>      </div>    </div>    <div class="row-fluid">      <table class="table table-striped table-hover"             id="tabel-event">        <col width="1%" />        <col width="6%" />        <col width="20%" />        <col width="6%" />        <col width="10%" />        <col width="10%" />        <col width="20%" />        <col width="5%" />        <col width="6%" />        <col width="6%" />        <thead>          <tr>            <th>              <input type="checkbox" name="" id=""                      onclick="                       var checkboxes = ('#tabel-event tbody input:checkbox');
                    if ($(this).attr('checked'))
                        $(checkboxes).attr('checked', true);
                    else
                        $(checkboxes).removeAttr('checked');
                                                                                                                                                                                                        "/>            </th>            <!--<th></th>-->            <th colspan="2">              <button name="filter[sort]"                      value="name"                      style="margin: 0; padding: 0">                Nama Event                <?php if ($this->filter['sort'] == 'name'): ?>                  <?php if ($this->filter['order'] == 'ASC'): ?>                  <span class="rulycon-arrow-up-2"></span>                  <?php elseif ($this->filter['order'] == 'DESC'): ?>                  <span class="rulycon-arrow-down-2"></span>                  <?php endif; ?>                <?php endif; ?>              </button>            </th>            <th>Status</th>            <th>Kategori</th>            <th>              <button name="filter[sort]"                      value="date_start"                      style="margin: 0; padding: 0">                Waktu                <?php if ($this->filter['sort'] == 'date_start'): ?>                  <?php if ($this->filter['order'] == 'ASC'): ?>                  <span class="rulycon-arrow-up-2"></span>                  <?php elseif ($this->filter['order'] == 'DESC'): ?>                  <span class="rulycon-arrow-down-2"></span>                  <?php endif; ?>                <?php endif; ?>            </th>            <th>              <button name="filter[sort]"                      value="time_created"                      style="margin: 0; padding: 0">                Tanggal                <?php if ($this->filter['sort'] == 'time_created'): ?>                  <?php if ($this->filter['order'] == 'ASC'): ?>                  <span class="rulycon-arrow-up-2"></span>                  <?php elseif ($this->filter['order'] == 'DESC'): ?>                  <span class="rulycon-arrow-down-2"></span>                  <?php endif; ?>                <?php endif; ?>              </button>            </th>            <th>              <button class="btn btn-link"                      name="filter[sort]"                      value="viewer"                      style="margin: 0; padding: 0">                <span class="rulycon-eye"></span>                <?php if ($this->filter['sort'] == 'viewer'): ?>                  <?php if ($this->filter['order'] == 'ASC'): ?>                  <span class="rulycon-arrow-up-2"></span>                  <?php elseif ($this->filter['order'] == 'DESC'): ?>                  <span class="rulycon-arrow-down-2"></span>                  <?php endif; ?>                <?php endif; ?>              </button>            </th>            <th>EN</th>            <th></th>          </tr>          <tr>            <th></th>            <th colspan="2">              <?php echo $this->formText('filter[name]', $this->filter['name'], array('class' => 'span12', 'style' => 'margin-bottom: 5px', 'placeholder' => 'Ketikan nama kegiatan untuk pencarian...')); ?>            </th>            <th>              <?php echo $this->formSelect('filter[status]', $this->filter['status'], array('class' => 'span12'), array(null => 'Tampilkan semua', 0 => "Diarspikan ({$this->statusesCount['archived']})", 1 => "Draft ({$this->statusesCount['draft']})", 2 => "Menunggu Persetujuan ({$this->statusesCount['pending']})", 3 => "Diterbitkan ({$this->statusesCount['publish']})")); ?>            </th>            <th></th>            <th></th>            <th></th>            <th></th>            <th></th>            <th></th>          </tr>        </thead>        <tbody>          <?php foreach ($this->events as $index => $event): ?>            <tr>              <td class="text-center"><input type="checkbox" name="events[]"                         value="<?php echo $event->event_id; ?>"/>              </td>              <td>                <?php
                                    $src = 'default.jpg';
                                    $w = 50;
                                    $h = 50;
                                    $q = 100;
                                    $src = 'default.jpg';
                                    if (is_file(UPLOAD_FOLDER . 'event/' . $event->main_pics)) {
                                        $src = "upload/event/{$event->main_pics}";
                                    } $timthumb = $this->imageUrl("timthumb.php?src={$src}&w={$w}&h={$h}&q={$q}")
                                    ?>                <img src="<?php echo $timthumb; ?>"                      alt=""                     class="thumbnail"                     title="<?php echo $event->main_pics; ?>"/>              </td>              <td>                <a target="_blank"                   href="                   <?php echo $this->url(array('id' => $event->event_id, 'slug' => $this->makeUrlFormat($event->name)), 'detail-kegiatan'); ?>">                     <?php echo $event->name; ?>                </a>              </td>              <td>                <?php
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       switch ($event->status) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           case Admin_EventController::STATUS_ARCHIVED: echo "<span class='text muted'>Diarspikan</span>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           case Admin_EventController::STATUS_DRAFT: echo "<span class='text muted'>Draft</span>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           case Admin_EventController::STATUS_PENDING: echo "<span class='text text-warning'>                      Menunggu Persetujuan</span>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               if ($this->userInfo->canApprove) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   $approve_url = $this->url(array('action' => 'approve', 'id' => $event->event_id));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   echo "<br />                      <a href='{$approve_url}'                        class='btn btn-mini'>Disetujui</a>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               } break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           case Admin_EventController::STATUS_PUBLISH: echo "<span class='text text-success'>                      Diterbitkan</span>";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ?>              </td>              <td><?php echo $event->category; ?></td>              <td>                <small>                  <?php if (date('d-m-Y', strtotime($event->date_start)) == date('d-m-Y', strtotime($event->date_end))): ?>                    <div><strong>Tanggal: </strong>                      <?php echo date('d-m-Y', strtotime($event->date_start)); ?>                    </div>                    <div>                      <strong>Pukul: </strong>                      <?php echo date('H:i', strtotime($event->date_start)); ?> -                      <?php echo date('H:i', strtotime($event->date_end)); ?>                    </div>                  <?php else: ?>                    <div>                      <strong>Mulai: </strong>                      <?php echo date('d-m-Y', strtotime($event->date_start)); ?>                    </div>                    <div>                      <strong>Selesai: </strong>                      <?php echo date('d-m-Y', strtotime($event->date_end)) ?>                    </div>                  <?php endif; ?>                </small>              </td>              <td>                <small>                  <div>                    Dibuat tanggal                     <?php echo Date('d-m-Y', strtotime($event->time_created)); ?>                    Oleh                     <a href="">                      <?php echo ucfirst($event->created_by); ?>                    </a>                  </div>                  <?php if (null != ($event->approved_at)): ?>                    <div>                      Disetujui Pada                      <?php echo Date('d-m-Y', strtotime($event->approved_at)); ?>                      Oleh <a href="">                        <?php echo ucfirst($event->approved_by); ?></a>                    </div>                  <?php endif; ?>                  <?php if (null != $event->updated_at): ?>                    <div>                      Disunting Pada                      <?php echo date('d-m-Y', strtotime($event->updated_at)); ?>                      Oleh <a href="">                        <?php echo ucfirst($event->updated_by); ?></a>                    </div>                  <?php endif; ?>                </small>              </td>              <td>                <span class="badge badge-info">                  <?php echo $event->viewer; ?>                </span>              </td>              <td class="text-center">                <?php if ($event->isTranslated): ?>                  <a title="Sunting translasi"                     href="<?php echo $this->url(array('action' => 'edit', 'id' => $event->event_id, 'lang' => 2)); ?>">                    <span class="rulycon-pencil"></span>                  </a>                  <a title="Pratinjau"                     target="_blank"                     href="<?php echo $this->url(array('id' => $event->event_id, 'slug' => $this->makeUrlFormat($event->name)), 'event-detail'); ?>">                    <span class="rulycon-eye-2"></span>                  </a>                  <a title="Hapus translasi"                     onclick="if (!confirm('Apakah anda yakin ingin ' + 'menghapus translasi ini?'))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           return false"                     href="<?php echo $this->url(array('action' => 'deletetranslation', 'id' => $event->event_id)); ?>">                    <span class="rulycon-remove-2"></span>                  </a>                <?php else: ?>                  <a title="Buat translasi"                     href="<?php echo $this->url(array('action' => 'edit', 'id' => $event->event_id, 'lang' => 2)); ?>">                    <span class="rulycon-pencil-2"></span>                  </a>                <?php endif ?>              </td>              <td class="text-center">                <?php if ('' != $this->filter['status'] && $this->filter['status'] == 0): ?>                  <a href="<?php echo $this->url(array('action' => 'restore', 'id' => $event->event_id)); ?>"                     title="Muat Ulang">                    <span class="rulycon-spinner-6"></span>                  </a>                <?php else: ?>                  <a href="<?php echo $this->url(array('action' => 'edit', 'id' => $event->event_id, 'lang' => 1)); ?>"                     title="Sunting">                    <span class="rulycon-pencil"></span>                  </a>                <?php endif; ?>                <a href="<?php echo $this->url(array('action' => 'report', 'id' => $event->event_id)); ?>"                   title="Buat laporan">                  <span class="rulycon-book"></span>                </a>                   <a onclick="if (!confirm('Apakah anda yakin ingin ' + 'menghapus kegiatan ini?'))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   return false"                   href="<?php echo $this->url(array('action' => 'delete', 'id' => $event->event_id)); ?>"                   title="Hapus">                  <span class="rulycon-remove-2"></span>                </a>              </td>            </tr>          <?php endforeach; ?>        </tbody>      </table>    </div>  </div></form>